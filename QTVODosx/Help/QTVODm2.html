<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title>Mode d'emploi pour QTVOD</title>
  <meta name="Author" content="RJVB">
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="1038.36">
  <meta name="AppleTitle" content="QTVOD Help">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: center; font: 11.0px 'ZapfEllipt BT'}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: justify; font: 11.0px 'Lucida Sans'; min-height: 12.0px}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: justify; font: 11.0px 'ZapfEllipt BT'}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: justify; font: 11.0px 'ZapfEllipt BT'; min-height: 13.0px}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: center; font: 9.0px Monaco}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 11.0px 'ZapfEllipt BT'; min-height: 13.0px}
    p.p7 {margin: 0.0px 0.0px 0.0px 28.4px; text-align: justify; text-indent: -28.4px; font: 11.0px 'ZapfEllipt BT'; min-height: 13.0px}
    p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #90176b}
    p.p9 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #318934}
    p.p10 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #2300b0}
    p.p11 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #9b893b}
    li.li3 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: justify; font: 11.0px 'ZapfEllipt BT'}
    span.s1 {letter-spacing: 0.0px}
    span.s2 {text-decoration: underline ; letter-spacing: 0.0px}
    span.s3 {font: 11.0px 'Lucida Grande'; letter-spacing: 0.0px}
    span.s4 {letter-spacing: 0.0px color: #a0221e}
    span.s5 {letter-spacing: 0.0px color: #90176b}
    span.s6 {text-decoration: underline ; letter-spacing: 0.0px color: #2300b0}
    span.s7 {letter-spacing: 0.0px color: #000000}
    span.s8 {letter-spacing: 0.0px color: #9b893b}
    span.Apple-tab-span {white-space:pre}
  </style>
</head>
<body>
<p class="p1"><span class="s1"><b>QTVODm2</b></span></p>
<p class="p1"><span class="s1"><b>-</b></span></p>
<p class="p1"><span class="s1"><b>un début de mode d'emploi</b></span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p3"><span class="s1">QTVODm2</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space"> </span>est un lecteur conçu pour l'exploration des vidéos enregistrées avec un dispositif du fabricant Brigade, sur certains des véhicules instrumentés de l'IFSTTAR (ex INRETS). Basé sur le moteur multi-média QuickTime(TM) et le 'plug-in' QTImage2Mov, QTVODm2 ouvre les fichiers '.VOD' originaux, isole les vues individuelles des 4 caméras et les affiche dans 5 fenêtres de façon à faciliter l'interprétation:</span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p5"><span class="s1">[vue caméra pilote]</span></p>
<p class="p5"><span class="s1">[vue caméra de gauche] [vue caméra avant] [vue caméra de droite]</span></p>
<p class="p5"><span class="s1">[––––-- piste TimeCode ––––--]</span></p>
<p class="p6"><span class="s1"></span><br></p>
<p class="p3"><span class="s1">Une fois la vidéo ouverte, QTVODm2 permet l'exploration de la vidéo de plusieurs façons. La fenêtre <i>TimeCode</i> dispose d'un <i>slider</i>, un <i>contrôleur</i> permettant de se positionner globalement dans l'enregistrement, ainsi que d'un menu <i>pop-up</i> permettant de faire un choix parmi les chapitres dont la vidéo peut disposer. Chacune des autres fenêtres permet une navigation trame par trame avec les touches curseur (flèches) horizontaux ; on peut également lancer/arrêter la lecture 'normale' avec la barre espace. Toutes ces commandes s'appliquent sur toutes les fenêtres au même temps, bien évidemment.</span></p>
<p class="p3"><span class="s1">La version pour MS Windows est pilotable par un logiciel d'exploration et traitement de données dynamiques ("données IEF"), permettant de situer ces données dans le contexte où elles ont été échantillonnées. La version pour Mac OS X ouvre les fichiers '.VOD' et '.QI2M' en 5 vues comme décrit ci-dessus, mais ouvre les autres types de fichier vidéo comme un lecteur classique.</span></p>
<p class="p3"><span class="s1">NB: actuellement, les fichiers VOD en format mpeg4 ne sont pas encore supportés, faute d'informations concernant ce format!</span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p3"><span class="s1">Quelques autres raccourcis clavier existent :</span></p>
<p class="p7"><span class="s1"><b></b></span><br></p>
<ul>
  <li class="li3"><span class="s1"><b>i</b><span class="Apple-tab-span">	</span>affiche une fenêtre avec un résumé des méta-données présentes dans l'enregistrement</span></li>
  <li class="li3"><span class="s1"><b>t</b><span class="Apple-tab-span">	</span>permet de déterminer le laps entre 2 moments, A et B. À chaque 2e appui, une fenêtre apparaît résumant les temps (relatifs et absolus) A et B, ainsi que la différence. Le temps B devient alors le temps A.</span></li>
  <li class="li3"><span class="s1"><b>b</b><span class="Apple-tab-span">	</span>envoie toutes les fenêtres vers le fond (bas de la pile)</span></li>
  <li class="li3"><span class="s1"><b>f</b><span class="Apple-tab-span">	</span>envoie toutes les fenêtres vers l'avant</span></li>
  <li class="li3"><span class="s1"><b>c</b><span class="Apple-tab-span">	</span>affiche/cache le <i>contrôleur</i> dans la fenêtre ciblée. Ceci permet de redimensionner uniquement cette fenêtre.</span></li>
  <li class="li3"><span class="s1"><b>p</b><span class="Apple-tab-span">	</span></span><span class="s2"><b>p</b></span><span class="s1">ositionne les trois autres fenêtres par rapport à la position actuelle de la fenêtre de la vue pilote (celle du milieu en haut). Ceci permet de déplacer l'ensemble des vues vers une position convenable.</span></li>
  <li class="li3"><span class="s1"><b>1</b><span class="Apple-tab-span">	</span><i>réduit</i> l'échelle des 4 fenêtres vidéo: division par 1/√2 .</span></li>
  <li class="li3"><span class="s1"><b>2</b><span class="Apple-tab-span">	</span><i>augmente</i> l'échelle des 4 fenêtres: multiplication par √2 .<span class="Apple-converted-space"> </span></span></li>
  <li class="li3"><span class="s1"><b>q</b><span class="Apple-tab-span">	</span>quitte le lecteur. (Command-q sous Mac OS X)</span></li>
</ul>
<p class="p4"><span class="s1"></span><br></p>
<p class="p1"><span class="s2">le fonctionnement expliqué</span><span class="s1"><span class="Apple-tab-span">	</span></span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p3"><span class="s1">Le système Brigade enregistre les flux de jusqu'à 4 caméras, dans un <i>quad</i>, c-a-d une trame composée de 4 images (canaux) en disposition 2x2. L'association entre caméra et canal du quad de la vidéo d'origine (numérotés de 1 à 4 de la gauche à la droite et de haut vers le bas) se fait via des arguments de ligne de commande, ou via un fichier XML de configuration (<i>design</i>). La piste <i>TimeCode</i> est obtenue automatiquement ; elle affiche l'heure exacte de la capture de chaque trame ainsi que certaines des informations GPS si présentes (heure UTC, vitesse et cap absolu).</span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p3"><span class="s1">À la première ouverture d'un fichier VOD, QTVODm2 fait une première importation 'invisible', à l'issue de laquelle un movie dite de référence QuickTime aura été créé, via un fichier temporaire qi2m (voir la documentation de QTImage2Mov pour une discussion de ce type de fichier). Les 4 vues et la piste TimeCode sont ensuite ouvertes de la même façon dans leurs fenêtres individuelles. Il en résulte qu'une ouverture suivante du même enregistrement se fait de façon quasi instantanée, peu importe la durée</span></p>
<p class="p3"><span class="s1">. À noter qu'il faut supprimer au moins le fichier cache principale manuellement si on modifie (corrige) le <i>design</i> de l'enregistrement.</span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p3"><span class="s1">Si un enregistrement s'ouvre correctement, QTVODm2 génère un dernier fichier qi2m qui contient le <i>design</i> actuel. Pour un fichier d'origine <i>F0007001.VOD</i>, il y aura donc un fichier <i>F0007001-design.qi2m</i>; l'ouverture de ce fichier donnera la disposition des 4 vues caméra plus la piste <i>TimeCode</i> dans une seule fenêtre de n'importe quel lecteur </span><span class="s2">autre que QTVODm2</span><span class="s1">. À noter que la lecture 'normale' peut ne pas se faire de façon synchronisée entre les vues, mais l'exploration en trame par trame (ou la fonction <i>toutes les trames/play all frames</i> de QuickTime Player) donnera le résultat attendu.</span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p1"><span class="s2">Arguments de ligne de commande (MS Windows)</span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p3"><span class="s1">QTVODm2 reconnait les arguments de ligne de commande suivants :</span></p>
<p class="p4"><span class="s1"></span><br></p>
<ul>
  <li class="li3"><span class="s1"><b>-freq</b> <b>f</b></span><span class="s3"><br>
</span><span class="s1">La fréquence (nombre de trames par seconde) n'est pas disponible dans les enregistrements d'origine. Elle peut être estimée, mais aussi spécifiée via cet argument. <i>f</i> est une valeur réelle (notation internationale).</span></li>
  <li class="li3"><span class="s1"><b>-timeZone h</b></span><span class="s3"><br>
</span><span class="s1">permet de spécifier le fuseau horaire pour l'interprétation de l'horodatage GPS. <i>h</i> est une valeur réelle (notation internationale) qui représente la différence en heures par rapport à l'UTC.</span></li>
  <li class="li3"><span class="s1"><b>-DST TRUE|FALSE</b></span><span class="s3"><br>
</span><span class="s1">spécifie si l'enregistrement a été fait en heure d'été (DST <i>true</i>) ou heure d'hiver.</span></li>
  <li class="li3"><span class="s1"><b>-scale s</b></span><span class="s3"><br>
</span><span class="s1">donne l'échelle d'affichage initiale. NB: une prochaine mise à l'échelle se fait toujours par rapport à la taille actuelle, et non pas la taille d'origine!</span></li>
  <li class="li3"><span class="s1"><b>-chForward i</b></span><span class="s3"><br>
</span><span class="s1">spécifie le canal contenant la vue de la caméra avant. <i>i</i> est un entier entre 1 (la vue en haut à gauche du quad d'origine) et 4 (la vue en bas à droite).</span></li>
  <li class="li3"><span class="s1"><b>-chPilot i</b></span><span class="s3"><br>
</span><span class="s1">idem pour la caméra pilote.</span></li>
  <li class="li3"><span class="s1"><b>-chLeft i</b></span><span class="s3"><b><br>
</b></span><span class="s1">idem pour la caméra de gauche.</span></li>
  <li class="li3"><span class="s1"><b>-chRight i</b></span><span class="s3"><b><br>
</b></span><span class="s1">idem pour la caméra de droite.</span></li>
  <li class="li3"><span class="s1"><b>-hFlip TRUE|FALSE</b></span><span class="s3"><br>
</span><span class="s1">spécifie si la vue des caméras de droite et de gauche doit être inversée horizontalement (caractéristique de la moto utilisée pour l'enregistrement).</span></li>
  <li class="li3"><span class="s1"><b>-client IP</b></span><span class="s3"><br>
</span><span class="s1">consigne QTVODm2 qu'une connexion doit être établi avec un serveur à l'adresse <i>IP</i> (une chaine avec une adresse IP4). Le protocole de communication est spécifique à QTVODm2 et ne fait pas l'objet du présent mode d'emploi.</span></li>
  <li class="li3"><span class="s1"><b>-attendVODDescription</b></span><span class="s3"><br>
</span><span class="s1">consigne QTVODm2 d'attendre à recevoir une description du <i>design</i> (association vues/caméras, fréquence, …) de la part du serveur.</span></li>
  <li class="li3"><span class="s1"><b>-assocData nom</b></span><span class="s3"><br>
</span><span class="s1">si la vidéo est associée à d'autres données, cette association peut être précisée via cet argument, par exemple avec le nom de fichier dans lequel les données se trouvent. Cette information est utilisée à la première importation d'un enregistrement vidéo (fichier .VOD) et stockée dans la vidéo cache principale. <i>nom</i> est obligatoire mais peut être une chaine vide (""); dans ce cas le nom enregistré sera celui du fichier VOD avec l'extension IEF.</span></li>
  <li class="li3"><span class="s1"><b>-VMGI TRUE|FALSE</b></span><span class="s3"><br>
</span><span class="s1">spécifie si la structure 'VMGI' du fichier VOD doit être utilisée (défaut) ou non. À utiliser uniquement en cas de problème d'importation, cette option effectue un scan exhaustif du fichier VOD. Cela permet de trouver toutes les trames valides, au coût d'une durée de traitement important.</span></li>
  <li class="li3"><span class="s1"><b>-log TRUE|FALSE</b></span><span class="s3"><br>
</span><span class="s1">spécifie si un suivi de l'importation du fichier VOD doit être enregistré (cela se fait par défaut).</span></li>
</ul>
<p class="p4"><span class="s1"></span><br></p>
<p class="p3"><span class="s1">Les arguments sur la ligne de commande qui ne correspondent pas à ceux de la liste ci-dessus sont pris pour des noms de fichier à ouvrir ; s'il y en a plus qu'un seul, le dernier est ouvert seulement</span></p>
<p class="p3"><span class="s1">. NB : il n'est pas nécessaire de préciser l'extension ; par exemple l'enregistrement F0007001.VOD peut être ouvert en donnant le nom F0007001.mov, F0007001.VOD mais aussi F0007001 tout court.</span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p1"><span class="s2">fichiers de configuration</span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p3"><span class="s1">Il est également possible de spécifier la configuration (le <i>design</i>) des enregistrements via des fichiers XML. Le protocole de recherche de ces fichiers donne une grande flexibilité de configuration, permettant d'avoir un <i>design</i> par défaut; un <i>design</i> qui s'applique à un ensemble d'enregistrements et qui peut hériter du <i>design</i> d'un autre ensemble d'enregistrements mais aussi d'avoir des cas particuliers qui s'appliquent à des enregistrements individuels.</span></p>
<p class="p3"><span class="s1">En clair:</span></p>
<ul>
  <li class="li3"><span class="s1">QTVODm2 cherche et interprète un fichier <i>VODdesign.xml</i> dans le répertoire dans lequel il est lancé.</span></li>
  <li class="li3"><span class="s1">Ensuite</span></li>
  <li class="li3"><span class="s1">Il cherche un fichier <i>VODdesign.xml</i> dans le répertoire où se trouve l'enregistrement à ouvrir, ensuite dans les répertoires parents, jusqu'à ce qu'un fichier est trouvé.</span></li>
  <li class="li3"><span class="s1">Et finalement</span></li>
  <li class="li3"><span class="s1">Il essaie d'ouvrir un fichier spécifique à l'enregistrement (pour <i>F0007001-design.xml</i> pour le fichier d'exemple), indépendamment si un fichier VODdesign.xml a déjà été lu.</span></li>
</ul>
<p class="p4"><span class="s1"></span><br></p>
<p class="p3"><span class="s1">Le format de ces fichiers XML reprend en grandes lignes celui des arguments de commande, mais les mots clefs existent en français comme en anglais. Voici un exemple qui représente le <i>design</i> par défaut. Tous les éléments sont optionnels (sauf <i>vod.design</i>); en cas de doublon, la dernière spécification l'emporte) :</span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p8"><span class="s1">&lt;?xml version=</span><span class="s4">"1.0"</span><span class="s1"> encoding=</span><span class="s4">"UTF-8"</span><span class="s1"> ?&gt;</span></p>
<p class="p9"><span class="s1">&lt;!-- le DOCTYPE est optionnel --&gt;</span></p>
<p class="p10"><span class="s5">&lt;!DOCTYPE plist PUBLIC </span><span class="s4">"-//Apple//DTD PLIST 1.0//EN"</span><span class="s5"> </span><span class="s4">"<a href="http://www.apple.com/DTDs/PropertyList-1.0.dtd"><span class="s6">http://www.apple.com/DTDs/PropertyList-1.0.dtd</span></a>"</span><span class="s5">&gt;</span></p>
<p class="p8"><span class="s1">&lt;vod.design&gt;</span></p>
<p class="p8"><span class="s7"><span class="Apple-tab-span">	</span></span><span class="s1">&lt;frequence </span><span class="s8">tps</span><span class="s1">=12,5 /&gt;</span></p>
<p class="p9"><span class="s7"><span class="Apple-tab-span">	</span></span><span class="s1">&lt;!-- ou bien --&gt;</span></p>
<p class="p8"><span class="s7"><span class="Apple-tab-span">	</span></span><span class="s1">&lt;frequency </span><span class="s8">fps</span><span class="s1">=12.5 /&gt;</span></p>
<p class="p8"><span class="s7"><span class="Apple-tab-span">	</span></span><span class="s1">&lt;echelle </span><span class="s8">facteur</span><span class="s1">=1 /&gt;</span></p>
<p class="p9"><span class="s7"><span class="Apple-tab-span">	</span></span><span class="s1">&lt;!-- ou bien --&gt;</span></p>
<p class="p8"><span class="s7"><span class="Apple-tab-span">	</span></span><span class="s1">&lt;scale </span><span class="s8">factor</span><span class="s1">=1 /&gt;</span></p>
<p class="p11"><span class="s7"><span class="Apple-tab-span">	</span></span><span class="s5">&lt;UTC </span><span class="s1">zone</span><span class="s5">=1 </span><span class="s1">DST</span><span class="s5">=</span><span class="s1">False flipLeftRight</span><span class="s5">=</span><span class="s1">True</span><span class="s5"> /&gt;</span></p>
<p class="p11"><span class="s7"><span class="Apple-tab-span">	</span></span><span class="s5">&lt;UTC </span><span class="s1">zone</span><span class="s5">=1 </span><span class="s1">DST</span><span class="s5">=</span><span class="s1">False flipGaucheDroite</span><span class="s5">=</span><span class="s1">True</span><span class="s5"> /&gt;</span></p>
<p class="p8"><span class="s7"><span class="Apple-tab-span">	</span></span><span class="s1">&lt;channels</span></p>
<p class="p11"><span class="s5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s1">forward</span><span class="s5">=1</span></p>
<p class="p11"><span class="s5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s1">pilot</span><span class="s5">=2</span></p>
<p class="p8"><span class="s1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s8">left</span><span class="s1">=3</span></p>
<p class="p8"><span class="s1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s8">right</span><span class="s1">=4 /&gt;</span></p>
<p class="p9"><span class="s7"><span class="Apple-tab-span">	</span></span><span class="s1">&lt;!-- ou bien --&gt;</span></p>
<p class="p8"><span class="s7"><span class="Apple-tab-span">	</span></span><span class="s1">&lt;canaux</span></p>
<p class="p11"><span class="s5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s1">avant</span><span class="s5">=1</span></p>
<p class="p11"><span class="s5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s1">pilote</span><span class="s5">=2</span></p>
<p class="p11"><span class="s5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s1">gauche</span><span class="s5">=3</span></p>
<p class="p8"><span class="s1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s8">droite</span><span class="s1">=4 /&gt;</span></p>
<p class="p9"><span class="s7"><span class="Apple-tab-span">	</span></span><span class="s1">&lt;!-- réglages "de bas niveau" de l'importation des fichiers VOD: --&gt;</span></p>
<p class="p8"><span class="s7"><span class="Apple-tab-span">	</span></span><span class="s1">&lt;parsing </span><span class="s8">useVMGI</span><span class="s1">=</span><span class="s4">"True"</span><span class="s1"> </span><span class="s8">log</span><span class="s1">=</span><span class="s4">"False"</span><span class="s1"> /&gt;</span></p>
<p class="p11"><span class="s7"><span class="Apple-tab-span">	</span></span><span class="s5">&lt;lecture </span><span class="s1">avecVMGI</span><span class="s5">=</span><span class="s4">"True"</span><span class="s5"> </span><span class="s1">journal</span><span class="s5">=</span><span class="s4">"False"</span><span class="s5"> /&gt;</span></p>
<p class="p8"><span class="s1">&lt;/vod.design&gt;</span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p1"><span class="s2">contrôle "à distance"</span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p3"><span class="s1">QTVODm2 et QTVOD.app peuvent être contrôlés à partir d'un autre logiciel. Pour la version MS Windows (QTVODm2), cela se fait par un protocole TCP/IP "requête/commande - réponse/confirmation" dont l'API est fournie dans les fichiers QTVODcomm.mod et QTVODcomm.def . La version pour Mac OS X exploite AppleScript pour proposer une fonctionnalité similaire à chaque logiciel qui supporte AppleScript, que ce soit directement ou via Python ou Ruby (quelques exemples sont fournis sur l'image disque de distribution).</span></p>
</body>
</html>
